\begin[papersize=a5]{document}
\script{
  allok = true
  local lfs = require("lfs")
  local _, dir_obj = lfs.dir("packages/")
  local file = dir_obj:next()
  while file do
    local f2, ok = file:gsub(".lua$", "")
    if ok ==1 and not file:match("pdf") and not file:match("url") then
      local pkg = require("packages/"..f2)
      if type(pkg) ~= "table" or not pkg.documentation then
        print("Undocumented package "..file)
        allok = false
      end
    end
    file = dir_obj:next()
  end
  if allok then SILE.typesetter:typeset("All OK!")
  else SILE.typesetter:typeset("There were undocumented packages")
  end
  SILE.typesetter:leaveHmode()
  SILE.typesetter.pageBuilder = SILE.defaultTypesetter.pageBuilder
}
\end{document}
